<!Doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="Calendar.css"> -->
    <script src="https://kit.fontawesome.com/4b2c9cbe81.js" crossorigin="anonymous"></script>
    <title>Calendar</title>
    <style>
        #Month {
            text-align: center;
        }

        .table {
            margin-bottom: 0;
        }

        tbody tr td {
            height: 80px;
            width: 100px;
            cursor: pointer;
        }

        #left {
            display: flex;
            justify-content: center;
        }

        #right {
            display: flex;
            justify-content: center;
        }

        td div {
            font-size: 15px;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            color: #f44;
            font-weight: bold;
            background-color: #bbb;
            border: 1px solid black;
            border-radius: 10px;
        }

        /* ok */
    </style>
</head>

<body>

    <div class="container">
        <div class="row">
            <table class="table table-bordered table-secondary">
                <thead>
                    <tr id="title">
                        <td id="left"><button><i class="fas fa-arrow-alt-circle-left"></i></button></td>
                        <th colspan="5" id="Month">YearMonth</th>
                        <td id="right"><button><i class="fas fa-arrow-alt-circle-right"></i></button></td>
                    </tr>
                    <tr>
                        <th scope="col">Sun</th>
                        <th scope="col">Mon</th>
                        <th scope="col">Tue</th>
                        <th scope="col">Wed</th>
                        <th scope="col">Thu</th>
                        <th scope="col">Fri</th>
                        <th scope="col">Sat</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>
    <template id="date">
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </template>

    <!-- The Modal -->
    <div class="modal" id="myModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Schedule</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="things-name" class="col-form-label">things:</label>
                            <input type="text" class="form-control" id="things-name"
                                placeholder="write down your schedule">
                        </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="save">Save</button>
                </div>

            </div>
        </div>
    </div>

    <!-- The InfoModal -->
    <div class="modal" id="InfoModal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Schedule</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="things-name" class="col-form-label">things:</label>
                            <input type="text" class="form-control" id="info-things-name"
                                placeholder="write down your schedule">
                        </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="Modify">Modify</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="Delete">Delete</button>
                </div>

            </div>
        </div>
    </div>
    <!-- <script src="Calendar.js"></script> -->
    <script>
        let dt = new Date();
let year_dt = dt.getFullYear();
let month_dt = dt.getMonth();
let date_dt = dt.getDate();
const month = ['January', 'Februay', 'Merch', 'April', 'May', 'June', 'June', 'August', 'September', 'October', 'November', 'December'];
let tbody = document.querySelector('tbody');
let id;
window.onload = initialize();

function initialize() {
    getCalendar();
    add_EventListener();
}

function getCalendar() {
    tbody.innerHTML = '';
    set_yearMonth();
    printCalendar();
    getStorage();
}
function printCalendar() {
    let date = 1;
    let template = document.getElementById('date');
    for (let i = 0; i < 6; i++) {
        let cloneContent = template.content.cloneNode(true);
        let tds = cloneContent.querySelectorAll('td');

        tds.forEach((element, index) => {
            let this_year = new Date(year_dt, month_dt, 1).getFullYear();
            let this_month = new Date(year_dt, month_dt, 1).getMonth();
            let first_day_dt = new Date(year_dt, month_dt, 1).getDay();
            let first_dt = new Date(year_dt, month_dt, date).getDate();
            let last_month = new Date(year_dt, month_dt - 1, 1).getMonth();
            let lastMonth_dt = new Date(year_dt, month_dt, 0).getDate();
            let lastMonth_day_dt = new Date(year_dt, month_dt, 0).getDay();
            let next_month = new Date(year_dt, month_dt + 1, 1).getMonth();
            let nextMonth_dt = new Date(year_dt, month_dt + 1, 0).getDate();
            let lastMonth_date = lastMonth_dt + (index - lastMonth_day_dt);
            if (i == 0) {
                if (first_day_dt <= index) {
                    element.textContent = first_dt;
                    element.style.backgroundColor = '#7c7';
                    element.id = this_year + '/' + this_month + '/' + first_dt;
                    date++;
                }
                else {
                    element.textContent = lastMonth_date;
                    element.id = this_year + '/' + last_month + '/' + lastMonth_date;
                }
            }
            else if (date <= nextMonth_dt) {
                element.textContent = first_dt;
                element.style.backgroundColor = '#7c7';
                element.id = this_year + '/' + this_month + '/' + first_dt;
                date++;
            }
            else {
                element.textContent = first_dt;
                element.id = this_year + '/' + next_month + '/' + first_dt;
                date++;
            }
        });
        tbody.appendChild(cloneContent);

    }
    let tbody_tds = document.querySelectorAll('tbody td');

    tbody_tds.forEach(element => {
        element.addEventListener('click', setModal, false);
    });
}
function set_yearMonth() {
    let yearMonth = document.getElementById('Month');
    let month_title = new Date(year_dt, month_dt, 1).getMonth();
    let year_title = new Date(year_dt, month_dt, 1).getFullYear();
    yearMonth.textContent = `${year_title}` + ' ' + month[month_title];
}
function add_EventListener() {
    let btn_left = document.getElementById('left');
    let btn_right = document.getElementById('right');
    btn_left.addEventListener('click', reduce_1, false);
    btn_right.addEventListener('click', add_1, false);
}
function reduce_1() {
    month_dt--;
    getCalendar();
}
function add_1() {
    month_dt++;
    getCalendar();
}
function setModal() {
    id = event.target.id;
    $('#myModal').modal('show');
    let btn_save = document.querySelector('#save');
    btn_save.addEventListener('click', clickSave, false);
    // event.stopPropagation();
}
function clickSave() {
    let things = document.querySelector('#things-name').value;

    let _temp = {
        'id': id,
        'things': things
    }
    let uuid = _uuid();
    localStorage.setItem(`${uuid}`, JSON.stringify(_temp));

    getCalendar();
}
function getStorage() {
    if (localStorage.length != 0) {
        for (let k = 0; k < localStorage.length; k++) {
            let storage = localStorage.getItem(`${localStorage.key(k)}`);
            let temp = JSON.parse(storage);
            let div = document.createElement('div');
            div.id = localStorage.key(k);
            div.innerHTML = temp.things;

            let target = document.getElementById(`${temp.id}`);
            div.addEventListener('click', setInfoModal, false);
            if (target != null)
                target.appendChild(div);
        }
    }
}
let modify_id;
let modify_key;
function setInfoModal() {
    document.querySelector('#info-things-name').value = event.target.textContent;
    $('#InfoModal').modal('show');
    modify_id = localStorage.getItem(event.target.id);
    modify_key = event.target.id;
    event.stopPropagation();
}

document.getElementById('Delete').addEventListener('click', Remove, false);
document.getElementById('Modify').addEventListener('click', Modify, false);

function Remove() {
    localStorage.removeItem(modify_key);
    getCalendar();
    // event.stopPropagation();
}
function Modify() {
    let temp = JSON.parse(modify_id);
    temp.things = document.querySelector('#info-things-name').value;
    localStorage.setItem(`${modify_key}`, JSON.stringify(temp));
    // localStorage.removeItem(modify_key);
    getCalendar();
    // event.stopPropagation();
}
function _uuid() {
    var d = Date.now();
    if (typeof performance !== 'undefined' && typeof performance.now === 'function') {
        d += performance.now(); //use high-precision timer if available
    }
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = (d + Math.random() * 16) % 16 | 0;
        d = Math.floor(d / 16);
        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
    });
}
// ok
    </script>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
</body>

</html>
<!-- ok -->